{"version":3,"sources":["../../client/page-loader.js"],"names":["hasRel","rel","link","document","createElement","relList","supports","pageLoadError","route","Error","relPrefetch","hasNoModule","requestIdleCallback","window","cb","setTimeout","normalizeRoute","replace","appendLink","href","as","Promise","res","rej","crossOrigin","process","env","__NEXT_CROSS_ORIGIN","onload","onerror","head","appendChild","PageLoader","constructor","buildId","assetPrefix","initialPage","pageCache","pageRegisterEvents","loadingRoutes","NODE_ENV","promisedBuildManifest","resolve","__BUILD_MANIFEST","__BUILD_MANIFEST_CB","promisedSsgManifest","__SSG_MANIFEST","__SSG_MANIFEST_CB","getDependencies","then","m","map","url","encodeURI","emit","error","getDataHref","asPath","ssg","pathname","hrefPathname","searchParams","search","query","asPathname","getHrefForSlug","path","dataRoute","isDynamic","interpolatedRoute","dynamicRegex","dynamicGroups","groups","dynamicMatches","Object","keys","every","param","value","repeat","optional","replaced","Array","isArray","escapePathDelimiters","join","prefetchData","s","_dataHref","has","querySelector","loadPage","reject","cachedPage","page","mod","fire","off","on","deps","forEach","d","endsWith","loadScript","catch","scriptRoute","script","__NEXT_MODERN_BUILD","type","src","body","registerPage","regFn","register","pageData","default","module","hot","status","console","log","check","removeStatusHandler","prefetch","isDependency","cn","navigator","connection","saveData","test","effectiveType","ext","encodeURIComponent","all","urls","dependencyUrl"],"mappings":"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","sourcesContent":["import mitt from '../next-server/lib/mitt'\nimport { addBasePath, markLoadingError } from '../next-server/lib/router/router'\nimport escapePathDelimiters from '../next-server/lib/router/utils/escape-path-delimiters'\nimport getAssetPathFromRoute from './../next-server/lib/router/utils/get-asset-path-from-route'\nimport { isDynamicRoute } from './../next-server/lib/router/utils/is-dynamic'\nimport { parseRelativeUrl } from './../next-server/lib/router/utils/parse-relative-url'\nimport { searchParamsToUrlQuery } from './../next-server/lib/router/utils/querystring'\nimport { getRouteMatcher } from './../next-server/lib/router/utils/route-matcher'\nimport { getRouteRegex } from './../next-server/lib/router/utils/route-regex'\n\nfunction hasRel(rel, link) {\n  try {\n    link = document.createElement('link')\n    return link.relList.supports(rel)\n  } catch {}\n}\n\nfunction pageLoadError(route) {\n  return markLoadingError(new Error(`Error loading ${route}`))\n}\n\nconst relPrefetch =\n  hasRel('preload') && !hasRel('prefetch')\n    ? // https://caniuse.com/#feat=link-rel-preload\n      // macOS and iOS (Safari does not support prefetch)\n      'preload'\n    : // https://caniuse.com/#feat=link-rel-prefetch\n      // IE 11, Edge 12+, nearly all evergreen\n      'prefetch'\n\nconst hasNoModule = 'noModule' in document.createElement('script')\n\nconst requestIdleCallback =\n  window.requestIdleCallback ||\n  function (cb) {\n    return setTimeout(cb, 1)\n  }\n\n/** @param {string} route */\nfunction normalizeRoute(route) {\n  if (route[0] !== '/') {\n    throw new Error(`Route name should start with a \"/\", got \"${route}\"`)\n  }\n\n  if (route === '/') return route\n  return route.replace(/\\/$/, '')\n}\n\nfunction appendLink(href, rel, as) {\n  return new Promise((res, rej, link) => {\n    link = document.createElement('link')\n    link.crossOrigin = process.env.__NEXT_CROSS_ORIGIN\n    link.href = href\n    link.rel = rel\n    if (as) link.as = as\n\n    link.onload = res\n    link.onerror = rej\n\n    document.head.appendChild(link)\n  })\n}\n\nexport default class PageLoader {\n  constructor(buildId, assetPrefix, initialPage) {\n    this.buildId = buildId\n    this.assetPrefix = assetPrefix\n\n    this.pageCache = {}\n    this.pageRegisterEvents = mitt()\n    this.loadingRoutes = {\n      // By default these 2 pages are being loaded in the initial html\n      '/_app': true,\n    }\n\n    // TODO: get rid of this limitation for rendering the error page\n    if (initialPage !== '/_error') {\n      this.loadingRoutes[initialPage] = true\n    }\n\n    if (process.env.NODE_ENV === 'production') {\n      this.promisedBuildManifest = new Promise((resolve) => {\n        if (window.__BUILD_MANIFEST) {\n          resolve(window.__BUILD_MANIFEST)\n        } else {\n          window.__BUILD_MANIFEST_CB = () => {\n            resolve(window.__BUILD_MANIFEST)\n          }\n        }\n      })\n    }\n    /** @type {Promise<Set<string>>} */\n    this.promisedSsgManifest = new Promise((resolve) => {\n      if (window.__SSG_MANIFEST) {\n        resolve(window.__SSG_MANIFEST)\n      } else {\n        window.__SSG_MANIFEST_CB = () => {\n          resolve(window.__SSG_MANIFEST)\n        }\n      }\n    })\n  }\n\n  // Returns a promise for the dependencies for a particular route\n  getDependencies(route) {\n    return this.promisedBuildManifest.then((m) => {\n      return m[route]\n        ? m[route].map((url) => `${this.assetPrefix}/_next/${encodeURI(url)}`)\n        : this.pageRegisterEvents.emit(route, {\n            error: pageLoadError(route),\n          }) ?? []\n    })\n  }\n\n  /**\n   * @param {string} href the route href (file-system path)\n   * @param {string} asPath the URL as shown in browser (virtual path); used for dynamic routes\n   */\n  getDataHref(href, asPath, ssg) {\n    const { pathname: hrefPathname, searchParams, search } = parseRelativeUrl(\n      href\n    )\n    const query = searchParamsToUrlQuery(searchParams)\n    const { pathname: asPathname } = parseRelativeUrl(asPath)\n    const route = normalizeRoute(hrefPathname)\n\n    const getHrefForSlug = (/** @type string */ path) => {\n      const dataRoute = getAssetPathFromRoute(path, '.json')\n      return addBasePath(\n        `/_next/data/${this.buildId}${dataRoute}${ssg ? '' : search}`\n      )\n    }\n\n    let isDynamic = isDynamicRoute(route),\n      interpolatedRoute\n    if (isDynamic) {\n      const dynamicRegex = getRouteRegex(route)\n      const dynamicGroups = dynamicRegex.groups\n      const dynamicMatches =\n        // Try to match the dynamic route against the asPath\n        getRouteMatcher(dynamicRegex)(asPathname) ||\n        // Fall back to reading the values from the href\n        // TODO: should this take priority; also need to change in the router.\n        query\n\n      interpolatedRoute = route\n      if (\n        !Object.keys(dynamicGroups).every((param) => {\n          let value = dynamicMatches[param] || ''\n          const { repeat, optional } = dynamicGroups[param]\n\n          // support single-level catch-all\n          // TODO: more robust handling for user-error (passing `/`)\n          let replaced = `[${repeat ? '...' : ''}${param}]`\n          if (optional) {\n            replaced = `${!value ? '/' : ''}[${replaced}]`\n          }\n          if (repeat && !Array.isArray(value)) value = [value]\n\n          return (\n            (optional || param in dynamicMatches) &&\n            // Interpolate group into data URL if present\n            (interpolatedRoute =\n              interpolatedRoute.replace(\n                replaced,\n                repeat\n                  ? value.map(escapePathDelimiters).join('/')\n                  : escapePathDelimiters(value)\n              ) || '/')\n          )\n        })\n      ) {\n        interpolatedRoute = '' // did not satisfy all requirements\n\n        // n.b. We ignore this error because we handle warning for this case in\n        // development in the `<Link>` component directly.\n      }\n    }\n\n    return isDynamic\n      ? interpolatedRoute && getHrefForSlug(interpolatedRoute)\n      : getHrefForSlug(route)\n  }\n\n  /**\n   * @param {string} href the route href (file-system path)\n   * @param {string} asPath the URL as shown in browser (virtual path); used for dynamic routes\n   */\n  prefetchData(href, asPath) {\n    const { pathname: hrefPathname } = parseRelativeUrl(href)\n    const route = normalizeRoute(hrefPathname)\n    return this.promisedSsgManifest.then((s, _dataHref) => {\n      requestIdleCallback(() => {\n        // Check if the route requires a data file\n        s.has(route) &&\n          // Try to generate data href, noop when falsy\n          (_dataHref = this.getDataHref(href, asPath, true)) &&\n          // noop when data has already been prefetched (dedupe)\n          !document.querySelector(\n            `link[rel=\"${relPrefetch}\"][href^=\"${_dataHref}\"]`\n          ) &&\n          // Inject the `<link rel=prefetch>` tag for above computed `href`.\n          appendLink(_dataHref, relPrefetch, 'fetch')\n      })\n    })\n  }\n\n  loadPage(route) {\n    route = normalizeRoute(route)\n\n    return new Promise((resolve, reject) => {\n      // If there's a cached version of the page, let's use it.\n      const cachedPage = this.pageCache[route]\n      if (cachedPage) {\n        const { error, page, mod } = cachedPage\n        error ? reject(error) : resolve({ page, mod })\n        return\n      }\n\n      const fire = ({ error, page, mod }) => {\n        this.pageRegisterEvents.off(route, fire)\n        delete this.loadingRoutes[route]\n\n        if (error) {\n          reject(error)\n        } else {\n          resolve({ page, mod })\n        }\n      }\n\n      // Register a listener to get the page\n      this.pageRegisterEvents.on(route, fire)\n\n      if (!this.loadingRoutes[route]) {\n        this.loadingRoutes[route] = true\n        if (process.env.NODE_ENV === 'production') {\n          this.getDependencies(route).then((deps) => {\n            deps.forEach((d) => {\n              if (\n                d.endsWith('.js') &&\n                !document.querySelector(`script[src^=\"${d}\"]`)\n              ) {\n                this.loadScript(d, route)\n              }\n              if (\n                d.endsWith('.css') &&\n                !document.querySelector(`link[rel=stylesheet][href^=\"${d}\"]`)\n              ) {\n                appendLink(d, 'stylesheet').catch(() => {\n                  // FIXME: handle failure\n                  // Right now, this is needed to prevent an unhandled rejection.\n                })\n              }\n            })\n          })\n        } else {\n          // Development only. In production the page file is part of the build manifest\n          route = normalizeRoute(route)\n          let scriptRoute = getAssetPathFromRoute(route, '.js')\n\n          const url = `${this.assetPrefix}/_next/static/chunks/pages${encodeURI(\n            scriptRoute\n          )}`\n          this.loadScript(url, route)\n        }\n      }\n    })\n  }\n\n  loadScript(url, route) {\n    const script = document.createElement('script')\n    if (process.env.__NEXT_MODERN_BUILD && hasNoModule) {\n      script.type = 'module'\n    }\n    script.crossOrigin = process.env.__NEXT_CROSS_ORIGIN\n    script.src = url\n    script.onerror = () => {\n      this.pageRegisterEvents.emit(route, { error: pageLoadError(url) })\n    }\n    document.body.appendChild(script)\n  }\n\n  // This method if called by the route code.\n  registerPage(route, regFn) {\n    const register = () => {\n      try {\n        const mod = regFn()\n        const pageData = { page: mod.default || mod, mod }\n        this.pageCache[route] = pageData\n        this.pageRegisterEvents.emit(route, pageData)\n      } catch (error) {\n        this.pageCache[route] = { error }\n        this.pageRegisterEvents.emit(route, { error })\n      }\n    }\n\n    if (process.env.NODE_ENV !== 'production') {\n      // Wait for webpack to become idle if it's not.\n      // More info: https://github.com/vercel/next.js/pull/1511\n      if (module.hot && module.hot.status() !== 'idle') {\n        console.log(\n          `Waiting for webpack to become \"idle\" to initialize the page: \"${route}\"`\n        )\n\n        const check = (status) => {\n          if (status === 'idle') {\n            module.hot.removeStatusHandler(check)\n            register()\n          }\n        }\n        module.hot.status(check)\n        return\n      }\n    }\n\n    register()\n  }\n\n  /**\n   * @param {string} route\n   * @param {boolean} [isDependency]\n   */\n  prefetch(route, isDependency) {\n    // https://github.com/GoogleChromeLabs/quicklink/blob/453a661fa1fa940e2d2e044452398e38c67a98fb/src/index.mjs#L115-L118\n    // License: Apache 2.0\n    let cn\n    if ((cn = navigator.connection)) {\n      // Don't prefetch if using 2G or if Save-Data is enabled.\n      if (cn.saveData || /2g/.test(cn.effectiveType)) return Promise.resolve()\n    }\n\n    /** @type {string} */\n    let url\n    if (isDependency) {\n      url = route\n    } else {\n      if (process.env.NODE_ENV !== 'production') {\n        route = normalizeRoute(route)\n\n        const ext =\n          process.env.__NEXT_MODERN_BUILD && hasNoModule ? '.module.js' : '.js'\n        const scriptRoute = getAssetPathFromRoute(route, ext)\n\n        url = `${this.assetPrefix}/_next/static/${encodeURIComponent(\n          this.buildId\n        )}/pages${encodeURI(scriptRoute)}`\n      }\n    }\n\n    return Promise.all(\n      document.querySelector(`link[rel=\"${relPrefetch}\"][href^=\"${url}\"]`)\n        ? []\n        : [\n            url &&\n              appendLink(\n                url,\n                relPrefetch,\n                url.endsWith('.css') ? 'style' : 'script'\n              ),\n            process.env.NODE_ENV === 'production' &&\n              !isDependency &&\n              this.getDependencies(route).then((urls) =>\n                Promise.all(\n                  urls.map((dependencyUrl) =>\n                    this.prefetch(dependencyUrl, true)\n                  )\n                )\n              ),\n          ]\n    ).then(\n      // do not return any data\n      () => {},\n      // swallow prefetch errors\n      () => {}\n    )\n  }\n}\n"]}